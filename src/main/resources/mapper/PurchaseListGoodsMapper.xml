<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.atguigu.jxc.dao.PurchaseListGoodsDao">

    <select id="getPurchaseListGoodsByNumber" resultType="com.atguigu.jxc.entity.PurchaseList">
        select a.purchase_list_id purchaseListId, a.purchase_number purchaseNumber,a.amount_paid amountPaid,
        a.amount_payable amountPayable,a.purchase_date purchaseDate,a.supplier_id supplierId,a.user_id userId,
        b.supplier_name supplierName,c.true_name trueName,c.remarks
        from t_purchase_list a
        left join t_supplier b
        on a.supplier_id=b.supplier_id
        left join t_user c
        on a.user_id=c.user_id
        <where>
        <if test=" purchaseNumber != null and purchaseNumber!=''">
            a.purchase_number like concat('%',#{purchaseNumber},'%')
        </if>
        <if test=" supplierId != null ">
             AND a.supplier_id = #{supplierId}
        </if>
        <if test=" state != null ">
             AND a.state = #{state}
        </if>
        <if test=" sTime != null and sTime!='' || eTime != null and eTime!=''">
            AND a.purchase_date between #{sTime} and #{eTime}
        </if>
<!--        <if test=" eTime != null and eTime!=''">-->
<!--            AND purchase_date &lt;= #{eTime}-->
<!--        </if>-->
        </where>
    </select>

    <select id="queryGoodsListBypurchaseListId" resultType="com.atguigu.jxc.entity.PurchaseListGoods">
         select purchase_list_goods_id purchaseListGoodsId,goods_id goodsId,goods_code goodsCode,
         goods_name goodsName,goods_model goodsModel,goods_unit goodsUnit,goods_num goodsNum,
         price,total,purchase_list_id purchaseListId,goods_type_id goodsTypeId
         from t_purchase_list_goods
         where purchase_list_id = #{purchaseListId}
    </select>


    <update id="delete">
        delete from t_purchase_list_goods where purchase_list_id =  #{purchaseListId}
    </update>




</mapper>